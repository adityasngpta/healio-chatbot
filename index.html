<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elegant GPT-4O Chatbot</title>
  <style>
    /* Reset & basic styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background: #f0f4f8;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      padding: 10px;
    }
    /* Chat container */
    .chat-container {
      background: #fff;
      width: 100%;
      max-width: 480px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    /* Header */
    .chat-header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 16px;
      text-align: center;
      position: relative;
    }
    .chat-header h1 {
      font-size: 1.5rem;
    }
    .clear-btn {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.3);
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .clear-btn:hover {
      background: rgba(255,255,255,0.5);
    }
    /* Messages container */
    .chat-messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      background: #f9f9f9;
    }
    .message {
      margin-bottom: 12px;
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 18px;
      line-height: 1.4;
      word-wrap: break-word;
      position: relative;
    }
    .message.user {
      background: #e0f7fa;
      align-self: flex-end;
      border-bottom-right-radius: 0;
    }
    .message.assistant {
      background: #e8eaf6;
      align-self: flex-start;
      border-bottom-left-radius: 0;
    }
    /* Typing indicator styling */
    .message.assistant.typing {
      font-style: italic;
      opacity: 0.7;
    }
    /* Form styling */
    form {
      display: flex;
      border-top: 1px solid #ddd;
    }
    #chat-input {
      flex: 1;
      border: none;
      padding: 14px;
      font-size: 1rem;
      outline: none;
    }
    form button {
      background: #667eea;
      border: none;
      color: #fff;
      padding: 0 20px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
    }
    form button:hover {
      background: #556cd6;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <h1>Chatbot</h1>
      <button class="clear-btn" id="clear-chat">Clear Chat</button>
    </div>
    <div class="chat-messages" id="chat-messages">
      <!-- Chat messages will appear here -->
    </div>
    <form id="chat-form">
      <input type="text" id="chat-input" placeholder="Type your message..." autocomplete="off" required />
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    // === Configuration ===
    // IMPORTANT: Do not expose your real API key in production!
    const OPENAI_API_KEY = "YOUR_OPENAI_API_KEY"; // Replace with your key (or use a secure proxy)
    const API_URL = "https://api.openai.com/v1/chat/completions";
    const MODEL = "gpt-4o"; // or change to your preferred model variant

    // === Conversation state ===
    // Start with a developer/system message setting the assistantâ€™s behavior.
    let conversation = [
      { role: "developer", content: "You are a helpful assistant." }
    ];

    // === DOM Elements ===
    const chatMessagesEl = document.getElementById("chat-messages");
    const chatFormEl = document.getElementById("chat-form");
    const chatInputEl = document.getElementById("chat-input");
    const clearChatBtn = document.getElementById("clear-chat");

    // === Helper Functions ===

    // Append a message bubble to the chat container
    function appendMessage(role, text, extraClass = "") {
      const messageEl = document.createElement("div");
      messageEl.classList.add("message", role);
      if (extraClass) messageEl.classList.add(extraClass);
      messageEl.textContent = text;
      chatMessagesEl.appendChild(messageEl);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
      return messageEl;
    }

    // Clear the chat conversation (except the developer message)
    function clearChat() {
      conversation = [{ role: "developer", content: "You are a helpful assistant." }];
      chatMessagesEl.innerHTML = "";
    }

    // Show a typing indicator for the assistant
    function showTypingIndicator() {
      return appendMessage("assistant", "Typing...", "typing");
    }

    // Remove a given element from the chat container
    function removeElement(element) {
      if (element && element.parentNode) {
        element.parentNode.removeChild(element);
      }
    }

    // Disable/enable form inputs to prevent double submissions
    function setFormDisabled(state) {
      chatInputEl.disabled = state;
      chatFormEl.querySelector("button").disabled = state;
    }

    // === Call GPT-4O API ===
    async function callGPT(messageHistory) {
      const payload = {
        model: MODEL,
        messages: messageHistory,
        store: true
      };

      const response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer " + OPENAI_API_KEY
        },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        const errorDetail = await response.text();
        throw new Error(`API Error: ${response.status} ${errorDetail}`);
      }

      return response.json();
    }

    // === Main form submission handler ===
    chatFormEl.addEventListener("submit", async (e) => {
      e.preventDefault();
      const userInput = chatInputEl.value.trim();
      if (!userInput) return;
      
      // Add the user's message to the conversation and UI
      appendMessage("user", userInput);
      conversation.push({ role: "user", content: userInput });
      
      // Clear input and disable form while waiting
      chatInputEl.value = "";
      setFormDisabled(true);
      
      // Add a typing indicator
      const typingIndicator = showTypingIndicator();
      
      try {
        const apiResponse = await callGPT(conversation);
        // Extract the assistant's reply
        const assistantReply = apiResponse.choices[0].message.content.trim();
        // Remove typing indicator and show the assistant's reply
        removeElement(typingIndicator);
        appendMessage("assistant", assistantReply);
        conversation.push({ role: "assistant", content: assistantReply });
      } catch (error) {
        removeElement(typingIndicator);
        appendMessage("assistant", "Oops! There was an error processing your request.");
        console.error(error);
      } finally {
        setFormDisabled(false);
        chatInputEl.focus();
      }
    });

    // Clear chat when clear button is clicked
    clearChatBtn.addEventListener("click", () => {
      clearChat();
    });
  </script>
</body>
</html>
